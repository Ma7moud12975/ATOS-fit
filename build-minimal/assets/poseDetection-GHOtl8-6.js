class t{constructor(){this.pose=null,this.isInitialized=!1,this.pushupState="up",this.pushupCount=0,this.highKneesCount=0,this.postureStatus="unknown",this.lastWarningTime=0,this.videoDimensionsLogged=!1,this.exerciseMode="pushups",this.accumulatedCorrectMs=0,this.timerRunning=!1,this.startCorrectTimestampMs=0,this.onPushupCount=null,this.onPostureChange=null,this.onFormFeedback=null,this.onTimeUpdate=null}setExerciseMode(t){const e=String(t||"").toLowerCase();"plank"===e?this.exerciseMode="plank":"squats"===e||"squat"===e?this.exerciseMode="squats":"lunges"===e||"lunge"===e?this.exerciseMode="lunges":"burpees"===e||"burpee"===e?this.exerciseMode="burpees":e.includes("mountain")||e.includes("climber")?this.exerciseMode="mountainclimbers":e.includes("high")&&e.includes("knees")?this.exerciseMode="highknees":this.exerciseMode="pushups"}async initialize(){var t;try{if(!window.Pose){let t=0;for(;!window.Pose&&t<50;)await new Promise(t=>setTimeout(t,200)),t++;if(!window.Pose)return!1}this.pose=new window.Pose({locateFile:t=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose/${t}`});const e=(null==(t=window.MediaPipeConfig)?void 0:t.POSE_CONFIG)||{modelComplexity:0,smoothLandmarks:!0,enableSegmentation:!1,smoothSegmentation:!1,minDetectionConfidence:.5,minTrackingConfidence:.5};return this.pose.setOptions(e),this.pose.onResults(this.onResults.bind(this)),this.isInitialized=!0,!0}catch(e){return!1}}async processFrame(t){var e;if(!this.isInitialized||!this.pose)return null;try{if(Math.random(),0===t.videoWidth||0===t.videoHeight)return void Math.random();this.videoDimensionsLogged||(this.videoDimensionsLogged=!0);const e=1920,s=1080;if(t.videoWidth>e||t.videoHeight>s)return;await this.pose.send({image:t})}catch(s){if(null==(e=s.message)?void 0:e.includes("memory access out of bounds"))return}}onResults(t){var e,s;if(this.lastResults=t,!t.poseLandmarks)return this.postureStatus="unknown",this.onPostureChange&&this.onPostureChange("unknown",null),void(this.timerRunning&&(this.accumulatedCorrectMs+=Date.now()-this.startCorrectTimestampMs,this.timerRunning=!1,this.startCorrectTimestampMs=0,this.onTimeUpdate&&this.onTimeUpdate(Math.floor(this.accumulatedCorrectMs/1e3))));const i=t.poseLandmarks;if("squats"===this.exerciseMode||"lunges"===this.exerciseMode||"pushups"===this.exerciseMode||"burpees"===this.exerciseMode)this.postureStatus="correct",this.onPostureChange&&this.onPostureChange("correct",i);else{const t=this.checkBackAlignment(i),n=t?"correct":"incorrect";if(n!==this.postureStatus&&(this.postureStatus=n,this.onPostureChange&&this.onPostureChange(this.postureStatus,i)),!t){const t=Date.now(),i=(null==(s=null==(e=window.MediaPipeConfig)?void 0:e.PLANK_CONFIG)?void 0:s.WARNING_COOLDOWN)||2e3;return t-this.lastWarningTime>i&&(this.playWarningSound(),this.lastWarningTime=t,this.onFormFeedback&&this.onFormFeedback({message:"Dangerous posture - straighten your back!",type:"warning",timestamp:t})),void("plank"===this.exerciseMode&&this.timerRunning&&(this.accumulatedCorrectMs+=t-this.startCorrectTimestampMs,this.timerRunning=!1,this.startCorrectTimestampMs=0,this.onTimeUpdate&&this.onTimeUpdate(Math.floor(this.accumulatedCorrectMs/1e3))))}}if("plank"===this.exerciseMode){const t=Date.now();this.timerRunning||(this.startCorrectTimestampMs=t,this.timerRunning=!0);const e=this.accumulatedCorrectMs+(t-(this.startCorrectTimestampMs||t)),s=Math.floor(e/1e3);return void(this.onTimeUpdate&&this.onTimeUpdate(s))}"squats"===this.exerciseMode?this.updateSquatCounter(i):"lunges"===this.exerciseMode?this.updateLungesCounter(i):"burpees"===this.exerciseMode?this.updateBurpeesCounter(i):"mountainclimbers"===this.exerciseMode?this.updateMountainClimbersCounter(i):"highknees"===this.exerciseMode?this.updateHighKneesCounter(i):this.updatePushupCounter(i)}calculateAngle(t,e,s){const i=Math.atan2(s.y-e.y,s.x-e.x)-Math.atan2(t.y-e.y,t.x-e.x);let n=Math.abs(180*i/Math.PI);return n>180&&(n=360-n),n}checkBackAlignment(t){var e,s,i;try{const n=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},o=t[n.LEFT_SHOULDER||11],a=t[n.RIGHT_SHOULDER||12],u=t[n.LEFT_HIP||23],h=t[n.RIGHT_HIP||24],r=t[n.LEFT_KNEE||25],c=t[n.RIGHT_KNEE||26],l=t[n.LEFT_ANKLE||27],p=t[n.RIGHT_ANKLE||28],d=t=>t&&(null==t.visibility||t.visibility>.5);if("plank"===this.exerciseMode){const t=d(o)&&d(u),e=d(a)&&d(h);if(!t&&!e)return!1}else if(!(d(o)&&d(a)&&d(u)&&d(h)&&d(r)&&d(c)))return!1;const m={x:(o.x+a.x)/2,y:(o.y+a.y)/2},y={x:(u.x+h.x)/2,y:(u.y+h.y)/2},g={x:(r.x+c.x)/2,y:(r.y+c.y)/2},C=d(l)&&d(p)?{x:(l.x+p.x)/2,y:(l.y+p.y)/2}:null,_=C||g,M={x:m.x-y.x,y:m.y-y.y},S=_?{x:_.x-y.x,y:_.y-y.y}:null;let E=!1;if("plank"===this.exerciseMode){const t=(null==(s=window.MediaPipeConfig)?void 0:s.PLANK_CONFIG)||{},e=d(o)&&d(u)&&d(l),i=d(a)&&d(h)&&d(p);if(e||i){const s=e?o:a,i=e?u:h,n=e?l:p,d=this.calculateAngle(s,i,n);if(E=d>=(t.MIN_SIDE_ANGLE??155),E&&C){const e=this.calculateAngle(u,r,l),s=this.calculateAngle(h,c,p),i=t.KNEE_MIN_DEG??150;E=E&&(e>=i&&s>=i)}}else{let e=-1;if(S){const t=Math.hypot(M.x,M.y)||1,s=Math.hypot(S.x,S.y)||1;e=(M.x*S.x+M.y*S.y)/(t*s)}const s=Math.abs(Math.max(-1,Math.min(1,e))),i=!!S&&s>=(t.STRAIGHT_ABS_COS_MIN??.9),n=m.x-y.x,o=m.y-y.y,a=Math.abs(180*Math.atan2(o,n)/Math.PI),d=t.HORIZ_MAX_DEG??35,g=a<=d||a>=180-d;let _=!0;if(C){const e=this.calculateAngle(u,r,l),s=this.calculateAngle(h,c,p),i=t.KNEE_MIN_DEG??150;_=e>=i&&s>=i}E=i&&g&&_}}else if("squats"===this.exerciseMode){const t=(null==(i=window.MediaPipeConfig)?void 0:i.SQUAT_CONFIG)||{},e=this.calculateAngle(o,u,r),s=(e+this.calculateAngle(a,h,c))/2,n=t.HIP_ANGLE_MIN??150,l=m.x-y.x,p=m.y-y.y,d=Math.abs(180*Math.atan2(l,-p)/Math.PI),g=t.TORSO_TILT_MAX??45;E=s>=n&&d<=g}else{let t=-1;if(S){const e=Math.hypot(M.x,M.y)||1,s=Math.hypot(S.x,S.y)||1;t=(M.x*S.x+M.y*S.y)/(e*s)}const e=Math.abs(Math.max(-1,Math.min(1,t)));E=!!S&&e>=.9}return E}catch(n){return!1}}updatePushupCounter(t){var e,s;try{const i=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},n=(null==(s=window.MediaPipeConfig)?void 0:s.PUSHUP_CONFIG)||{},o=t[i.LEFT_SHOULDER||11],a=t[i.LEFT_ELBOW||13],u=t[i.LEFT_WRIST||15],h=t[i.RIGHT_SHOULDER||12],r=t[i.RIGHT_ELBOW||14],c=t[i.RIGHT_WRIST||16];if(!(o&&a&&u&&h&&r&&c))return;const l=this.calculateAngle(o,a,u),p=(l+this.calculateAngle(h,r,c))/2,d=(o.y+h.y)/2,m=n.ELBOW_ANGLE_DOWN||95,y=n.ELBOW_ANGLE_UP||155,g=n.SHOULDER_HEIGHT_DOWN||.02,C=p<=m||d>=1-g,_=p>=y;"up"===this.pushupState?C&&(this.pushupState="down",this.pushupCount+=1,this.playSuccessSound(),this.onPushupCount&&this.onPushupCount(this.pushupCount),this.onFormFeedback&&this.onFormFeedback({message:`Push-up ${this.pushupCount}`,type:"success",timestamp:Date.now()})):"down"===this.pushupState&&_&&(this.pushupState="up")}catch(i){}}updateSquatCounter(t){var e,s;try{const i=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},n=(null==(s=window.MediaPipeConfig)?void 0:s.SQUAT_CONFIG)||{},o=t[i.LEFT_HIP||23],a=t[i.RIGHT_HIP||24],u=t[i.LEFT_KNEE||25],h=t[i.RIGHT_KNEE||26],r=t[i.LEFT_ANKLE||27],c=t[i.RIGHT_ANKLE||28],l=t[i.LEFT_SHOULDER||11],p=t[i.RIGHT_SHOULDER||12];if(!(o&&a&&u&&h&&r&&c&&l&&p))return;const d={x:(o.x+a.x)/2,y:(o.y+a.y)/2},m={x:(u.x+h.x)/2,y:(u.y+h.y)/2},y=(r.x,c.x,r.y,c.y,l.x,p.x,l.y,p.y,this.calculateAngle(o,u,r)),g=(this.calculateAngle(a,h,c),this.calculateAngle(l,o,u)),C=(this.calculateAngle(p,a,h),n.KNEE_ANGLE_DOWN,n.KNEE_ANGLE_UP,n.HIP_ANGLE_MIN,d.y),_=m.y,M=C>_,S=C<_;"up"===this.pushupState?M&&(this.pushupState="down",this.pushupCount+=1,this.playSuccessSound(),this.onPushupCount&&this.onPushupCount(this.pushupCount),this.onFormFeedback&&this.onFormFeedback({message:`Squat ${this.pushupCount}`,type:"success",timestamp:Date.now()})):"down"===this.pushupState&&S&&(this.pushupState="up")}catch(i){}}updateLungesCounter(t){var e,s;try{const i=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},n=(null==(s=window.MediaPipeConfig)||s.LUNGES_CONFIG,t[i.LEFT_HIP||23]),o=t[i.RIGHT_HIP||24],a=t[i.LEFT_KNEE||25],u=t[i.RIGHT_KNEE||26],h=t[i.LEFT_ANKLE||27],r=t[i.RIGHT_ANKLE||28];if(!(n&&o&&a&&u&&h&&r))return;const c={x:(n.x+o.x)/2,y:(n.y+o.y)/2},l=this.calculateAngle(n,a,h),p=this.calculateAngle(o,u,r),d=l<p,m=d?a:u,y=d?l:p,g=d?p:l,C=c.y>m.y,_=y<=85||g<=90||C,M=y>=160&&g>=150;"up"===this.pushupState?_&&(this.pushupState="down",this.pushupCount+=1,this.playSuccessSound(),this.onPushupCount&&this.onPushupCount(this.pushupCount),this.onFormFeedback&&this.onFormFeedback({message:`Lunge ${this.pushupCount}`,type:"success",timestamp:Date.now()})):"down"===this.pushupState&&M&&(this.pushupState="up")}catch(i){}}updateMountainClimbersCounter(t){var e;try{const s=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},i=t[s.LEFT_HIP||23],n=t[s.RIGHT_HIP||24],o=t[s.LEFT_KNEE||25],a=t[s.RIGHT_KNEE||26],u=t[s.LEFT_ANKLE||27],h=t[s.RIGHT_ANKLE||28];if(!(i&&n&&o&&a&&u&&h))return;Math.abs(o.y-i.y),Math.abs(a.y-n.y);this._lastLeftKneeY||(this._lastLeftKneeY=o.y),this._lastRightKneeY||(this._lastRightKneeY=a.y),this._climberState||(this._climberState="neutral"),this._lastClimberTime||(this._lastClimberTime=Date.now());const r=.05,c=250,l=Date.now(),p=o.y-this._lastLeftKneeY,d=a.y-this._lastRightKneeY,m=p>r&&d<-r||p<-r&&d>r;if("neutral"===this._climberState){if(m&&l-this._lastClimberTime>c&&(this._climberState="moving",this._lastClimberTime=l,this.pushupCount+=1,this.playSuccessSound(),this.onPushupCount&&this.onPushupCount(this.pushupCount),this.onFormFeedback)){const t=p>d?"Left":"Right";this.onFormFeedback({message:`${t} knee drive - Rep ${this.pushupCount}`,type:"success",timestamp:l})}}else"moving"===this._climberState&&(m||(this._climberState="neutral"));this._lastLeftKneeY=o.y,this._lastRightKneeY=a.y,Math.abs(i.y-n.y)>.1&&this.onFormFeedback&&Math.random()<.1&&this.onFormFeedback({message:"Keep hips level!",type:"warning",timestamp:l})}catch(s){}}updateBurpeesCounter(t){var e;try{const s=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},i=t[s.NOSE||0],n=t[s.LEFT_WRIST||15],o=t[s.RIGHT_WRIST||16],a=t[s.LEFT_INDEX||19],u=t[s.RIGHT_INDEX||20];if(!i||!n||!o)return;const h=i.y,r=a?a.y:n.y,c=u?u.y:o.y,l=r<h&&c<h;this._burpeeState||(this._burpeeState="ready"),"ready"===this._burpeeState?l&&(this._burpeeState="jumping",this.pushupCount+=1,this.playSuccessSound(),this.onPushupCount&&this.onPushupCount(this.pushupCount),this.onFormFeedback&&this.onFormFeedback({message:`Burpee ${this.pushupCount} - Hands above head!`,type:"success",timestamp:Date.now()})):"jumping"===this._burpeeState&&(l||(this._burpeeState="ready"))}catch(s){}}updateHighKneesCounter(t){var e;try{const s=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},i=t[s.LEFT_HIP||23],n=t[s.RIGHT_HIP||24],o=t[s.LEFT_KNEE||25],a=t[s.RIGHT_KNEE||26],u=t[s.LEFT_ANKLE||27],h=t[s.RIGHT_ANKLE||28];if(!(i&&n&&o&&a&&u&&h))return;o.y,i.y,a.y,n.y;const r=.1,c=i.y-o.y>r,l=n.y-a.y>r;this._highKneesState||(this._highKneesState="down"),"down"===this._highKneesState?(c||l)&&(this._highKneesState="up",this.highKneesCount+=1,this.playSuccessSound(),this.onPushupCount&&this.onPushupCount(this.highKneesCount),this.onFormFeedback&&this.onFormFeedback({message:`High Knee ${this.highKneesCount}`,type:"success",timestamp:Date.now()})):"up"===this._highKneesState&&(c||l||(this._highKneesState="down"))}catch(s){}}playWarningSound(){try{const t=new(window.AudioContext||window.webkitAudioContext),e=t.createOscillator(),s=t.createGain();e.connect(s),s.connect(t.destination),e.frequency.setValueAtTime(800,t.currentTime),e.type="sine",s.gain.setValueAtTime(0,t.currentTime),s.gain.linearRampToValueAtTime(.3,t.currentTime+.1),s.gain.exponentialRampToValueAtTime(.01,t.currentTime+.5),e.start(t.currentTime),e.stop(t.currentTime+.5)}catch(t){}}playSuccessSound(){try{const t=new Audio("/assets/sounds/pop.wav");t.volume=.5,t.play().catch(t=>{})}catch(t){}}drawPoseOverlay(t,e,s,i){if(Math.random(),!e.poseLandmarks||!t)return;t.save(),t.clearRect(0,0,s,i);const n=e.poseLandmarks;n.forEach((e,n)=>{if(e.visibility&&e.visibility>.5){const n=e.x*s,o=e.y*i;t.beginPath(),t.arc(n,o,6,0,2*Math.PI),t.fillStyle=e.visibility>.7?"#10B981":"#F59E0B",t.fill(),t.strokeStyle="#FFFFFF",t.lineWidth=2,t.stroke()}}),Math.random(),this.drawBasicConnections(t,n,s,i),t.restore()}drawBasicConnections(t,e,s,i){[[11,12],[11,13],[13,15],[12,14],[14,16],[11,23],[12,24],[23,24],[23,25],[25,27],[24,26],[26,28]].forEach(([n,o])=>{const a=e[n],u=e[o];a&&u&&a.visibility>.5&&u.visibility>.5&&(t.beginPath(),t.moveTo(a.x*s,a.y*i),t.lineTo(u.x*s,u.y*i),t.strokeStyle="#3B82F6",t.lineWidth=3,t.stroke())}),Math.random()}resetCounter(){this.pushupCount=0,this.highKneesCount=0,this.pushupState="up",this.postureStatus="unknown",this.accumulatedCorrectMs=0,this.timerRunning=!1,this.startCorrectTimestampMs=0}getStats(){return{count:"highknees"===this.exerciseMode?this.highKneesCount:this.pushupCount,state:this.pushupState,posture:this.postureStatus,timeSec:Math.floor((this.accumulatedCorrectMs+(this.timerRunning?Date.now()-this.startCorrectTimestampMs:0))/1e3)}}getLastResults(){return this.lastResults}setCallbacks({onPushupCount:t,onPostureChange:e,onFormFeedback:s,onTimeUpdate:i}){this.onPushupCount=t,this.onPostureChange=e,this.onFormFeedback=s,this.onTimeUpdate=i}cleanup(){this.pose&&(this.pose.close(),this.pose=null),this.isInitialized=!1}}export{t as default};
//# sourceMappingURL=poseDetection-GHOtl8-6.js.map
